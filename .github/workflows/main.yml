name: WordPress Auto Posting

on:
schedule:
# 한국 시간(KST) 기준 오전 07:00 ~ 익일 오전 01:00까지 매시간 정각 실행 (UTC 기준 22:00 ~ 16:00)
- cron: '0 22,23,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16 * * *'
workflow_dispatch: # 수동 실행 버튼

jobs:
run-auto-post:
runs-on: ubuntu-latest
timeout-minutes: 180 # 랜덤 대기 시간을 고려하여 타임아웃 넉넉히 설정

steps:
  - name: Checkout code
    uses: actions/checkout@v4

  - name: Set up Python
    uses: actions/setup-python@v5
    with:
      python-version: '3.10'

  - name: Install dependencies
    run: |
      pip install requests beautifulsoup4 Pillow

  - name: Run posting script
    env:
      GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
      WP_USERNAME: ${{ secrets.WP_USERNAME }}
      WP_APP_PASSWORD: ${{ secrets.WP_APP_PASSWORD }}
      WP_BASE_URL: ${{ secrets.WP_BASE_URL }}
      # 테스트 시 아래 값을 'true'로 변경하면 대기 시간 없이 즉시 실행됩니다.
      TEST_MODE: 'false'
    run: python -u main.py
